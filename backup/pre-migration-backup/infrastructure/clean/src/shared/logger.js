"use strict";
/**
 * Centralized logging utility for Trinity Lambda functions
 * Provides structured logging with CloudWatch integration
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LogUtils = exports.logger = exports.PerformanceTimer = exports.LogLevel = void 0;
exports.createLogger = createLogger;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class TrinityLogger {
    constructor(context = {}) {
        this.logLevel = this.getLogLevelFromEnv();
        this.context = {
            functionName: process.env.AWS_LAMBDA_FUNCTION_NAME,
            ...context,
        };
    }
    getLogLevelFromEnv() {
        const level = process.env.LOG_LEVEL?.toUpperCase() || 'INFO';
        switch (level) {
            case 'DEBUG': return LogLevel.DEBUG;
            case 'INFO': return LogLevel.INFO;
            case 'WARN': return LogLevel.WARN;
            case 'ERROR': return LogLevel.ERROR;
            default: return LogLevel.INFO;
        }
    }
    shouldLog(level) {
        return level >= this.logLevel;
    }
    createLogEntry(level, message, context, error, metadata) {
        const entry = {
            timestamp: new Date().toISOString(),
            level: LogLevel[level],
            message,
            context: { ...this.context, ...context },
            metadata,
        };
        if (error) {
            entry.error = {
                name: error.name,
                message: error.message,
                stack: error.stack,
            };
        }
        return entry;
    }
    log(level, message, context, error, metadata) {
        if (!this.shouldLog(level))
            return;
        const entry = this.createLogEntry(level, message, context, error, metadata);
        // Use appropriate console method based on level
        switch (level) {
            case LogLevel.DEBUG:
                console.debug(JSON.stringify(entry));
                break;
            case LogLevel.INFO:
                console.info(JSON.stringify(entry));
                break;
            case LogLevel.WARN:
                console.warn(JSON.stringify(entry));
                break;
            case LogLevel.ERROR:
                console.error(JSON.stringify(entry));
                break;
        }
    }
    debug(message, context, metadata) {
        this.log(LogLevel.DEBUG, message, context, undefined, metadata);
    }
    info(message, context, metadata) {
        this.log(LogLevel.INFO, message, context, undefined, metadata);
    }
    warn(message, context, metadata) {
        this.log(LogLevel.WARN, message, context, undefined, metadata);
    }
    error(message, error, context, metadata) {
        this.log(LogLevel.ERROR, message, context, error, metadata);
    }
    // Business metrics logging
    logBusinessMetric(metricName, value, unit = 'Count', context, metadata) {
        this.info(`ðŸ“Š Business Metric: ${metricName}`, context, {
            metric: {
                name: metricName,
                value,
                unit,
            },
            ...metadata,
        });
    }
    // Performance timing
    logPerformance(operation, duration, success, context, metadata) {
        const status = success ? 'SUCCESS' : 'FAILED';
        this.info(`â±ï¸ ${operation}: ${duration}ms (${status})`, context, {
            performance: {
                operation,
                duration,
                success,
            },
            ...metadata,
        });
    }
    // Create child logger with additional context
    child(additionalContext) {
        return new TrinityLogger({ ...this.context, ...additionalContext });
    }
    // Update context for current logger
    updateContext(additionalContext) {
        this.context = { ...this.context, ...additionalContext };
    }
}
// Performance timer utility
class PerformanceTimer {
    constructor(operation, logger) {
        this.operation = operation;
        this.logger = logger;
        this.startTime = Date.now();
        this.logger.debug(`ðŸš€ Starting ${operation}`);
    }
    finish(success = true, errorType, metadata) {
        const duration = Date.now() - this.startTime;
        this.logger.logPerformance(this.operation, duration, success, undefined, {
            errorType,
            ...metadata,
        });
    }
    finishWithError(error, metadata) {
        const duration = Date.now() - this.startTime;
        this.logger.error(`âŒ ${this.operation} failed after ${duration}ms`, error, undefined, metadata);
        this.finish(false, error.name, metadata);
    }
}
exports.PerformanceTimer = PerformanceTimer;
// Default logger instance
exports.logger = new TrinityLogger();
// Factory function for creating loggers with context
function createLogger(context) {
    return new TrinityLogger(context);
}
// Utility functions for common logging patterns
exports.LogUtils = {
    // Log Lambda function start
    logFunctionStart: (functionName, event, context) => {
        exports.logger.info(`ðŸ  ${functionName} Handler Started`, context, {
            event: JSON.stringify(event, null, 2),
        });
    },
    // Log Lambda function end
    logFunctionEnd: (functionName, result, context) => {
        exports.logger.info(`âœ… ${functionName} Handler Completed`, context, {
            result: typeof result === 'object' ? JSON.stringify(result, null, 2) : result,
        });
    },
    // Log GraphQL operation
    logGraphQLOperation: (fieldName, args, userId) => {
        exports.logger.info(`ðŸ” GraphQL Operation: ${fieldName}`, { userId, operation: fieldName }, {
            arguments: JSON.stringify(args, null, 2),
        });
    },
    // Log database operation
    logDatabaseOperation: (operation, tableName, key, context) => {
        exports.logger.debug(`ðŸ—„ï¸ DynamoDB ${operation}`, { ...context, tableName }, {
            key: JSON.stringify(key),
        });
    },
    // Log external API call
    logExternalAPICall: (service, endpoint, method, context) => {
        exports.logger.debug(`ðŸŒ External API Call: ${service}`, context, {
            endpoint,
            method,
        });
    },
    // Log cache operation
    logCacheOperation: (operation, cacheKey, hit, context) => {
        const status = hit ? 'HIT' : 'MISS';
        exports.logger.debug(`ðŸ’¾ Cache ${operation}: ${status}`, context, {
            cacheKey,
            hit,
        });
    },
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9nZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7OztBQThNSCxvQ0FFQztBQTlNRCxJQUFZLFFBS1g7QUFMRCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtBQUNYLENBQUMsRUFMVyxRQUFRLHdCQUFSLFFBQVEsUUFLbkI7QUF5QkQsTUFBTSxhQUFhO0lBSWpCLFlBQVksVUFBc0IsRUFBRTtRQUNsQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxPQUFPLEdBQUc7WUFDYixZQUFZLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0I7WUFDbEQsR0FBRyxPQUFPO1NBQ1gsQ0FBQztJQUNKLENBQUM7SUFFTyxrQkFBa0I7UUFDeEIsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLElBQUksTUFBTSxDQUFDO1FBQzdELFFBQVEsS0FBSyxFQUFFLENBQUM7WUFDZCxLQUFLLE9BQU8sQ0FBQyxDQUFDLE9BQU8sUUFBUSxDQUFDLEtBQUssQ0FBQztZQUNwQyxLQUFLLE1BQU0sQ0FBQyxDQUFDLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQztZQUNsQyxLQUFLLE1BQU0sQ0FBQyxDQUFDLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQztZQUNsQyxLQUFLLE9BQU8sQ0FBQyxDQUFDLE9BQU8sUUFBUSxDQUFDLEtBQUssQ0FBQztZQUNwQyxPQUFPLENBQUMsQ0FBQyxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUM7UUFDaEMsQ0FBQztJQUNILENBQUM7SUFFTyxTQUFTLENBQUMsS0FBZTtRQUMvQixPQUFPLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ2hD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QUFTLENBQUMsR0FBRyxDQUFDO1NBQ3pCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCx3QkFBd0I7SUFDeEIsa0JBQWtCLEVBQUUsQ0FBQyxPQUFlLEVBQUUsUUFBZ0IsRUFBRSxNQUFjLEVBQUUsT0FBb0IsRUFBRSxFQUFFO1FBQzlGLGNBQU0sQ0FBQyxLQUFLLENBQUMseUJBQXlCLE9BQU8sRUFBRSxFQUFFLE9BQU8sRUFBRTtZQUN4RCxRQUFRO1lBQ1IsTUFBTTtTQUNQLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxzQkFBc0I7SUFDdEIsaUJBQWlCLEVBQUUsQ0FBQyxTQUFpQixFQUFFLFFBQWdCLEVBQUUsR0FBWSxFQUFFLE9BQW9CLEVBQUUsRUFBRTtRQUM3RixNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ3BDLGNBQU0sQ0FBQyxLQUFLLENBQUMsWUFBWSxTQUFTLEtBQUssTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFO1lBQ3hELFFBQVE7WUFDUixHQUFHO1NBQ0osQ0FBQyxDQUFDO0lBQ0wsQ0FBQztDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ2VudHJhbGl6ZWQgbG9nZ2luZyB1dGlsaXR5IGZvciBUcmluaXR5IExhbWJkYSBmdW5jdGlvbnNcclxuICogUHJvdmlkZXMgc3RydWN0dXJlZCBsb2dnaW5nIHdpdGggQ2xvdWRXYXRjaCBpbnRlZ3JhdGlvblxyXG4gKi9cclxuXHJcbmV4cG9ydCBlbnVtIExvZ0xldmVsIHtcclxuICBERUJVRyA9IDAsXHJcbiAgSU5GTyA9IDEsXHJcbiAgV0FSTiA9IDIsXHJcbiAgRVJST1IgPSAzLFxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvZ0NvbnRleHQge1xyXG4gIHJlcXVlc3RJZD86IHN0cmluZztcclxuICB1c2VySWQ/OiBzdHJpbmc7XHJcbiAgcm9vbUlkPzogc3RyaW5nO1xyXG4gIGZ1bmN0aW9uTmFtZT86IHN0cmluZztcclxuICBvcGVyYXRpb24/OiBzdHJpbmc7XHJcbiAgW2tleTogc3RyaW5nXTogYW55O1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIExvZ0VudHJ5IHtcclxuICB0aW1lc3RhbXA6IHN0cmluZztcclxuICBsZXZlbDogc3RyaW5nO1xyXG4gIG1lc3NhZ2U6IHN0cmluZztcclxuICBjb250ZXh0PzogTG9nQ29udGV4dDtcclxuICBlcnJvcj86IHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIG1lc3NhZ2U6IHN0cmluZztcclxuICAgIHN0YWNrPzogc3RyaW5nO1xyXG4gIH07XHJcbiAgZHVyYXRpb24/OiBudW1iZXI7XHJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG59XHJcblxyXG5jbGFzcyBUcmluaXR5TG9nZ2VyIHtcclxuICBwcml2YXRlIGxvZ0xldmVsOiBMb2dMZXZlbDtcclxuICBwcml2YXRlIGNvbnRleHQ6IExvZ0NvbnRleHQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGNvbnRleHQ6IExvZ0NvbnRleHQgPSB7fSkge1xyXG4gICAgdGhpcy5sb2dMZXZlbCA9IHRoaXMuZ2V0TG9nTGV2ZWxGcm9tRW52KCk7XHJcbiAgICB0aGlzLmNvbnRleHQgPSB7XHJcbiAgICAgIGZ1bmN0aW9uTmFtZTogcHJvY2Vzcy5lbnYuQVdTX0xBTUJEQV9GVU5DVElPTl9OQU1FLFxyXG4gICAgICAuLi5jb250ZXh0LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0TG9nTGV2ZWxGcm9tRW52KCk6IExvZ0xldmVsIHtcclxuICAgIGNvbnN0IGxldmVsID0gcHJvY2Vzcy5lbnYuTE9HX0xFVkVMPy50b1VwcGVyQ2FzZSgpIHx8ICdJTkZPJztcclxuICAgIHN3aXRjaCAobGV2ZWwpIHtcclxuICAgICAgY2FzZSAnREVCVUcnOiByZXR1cm4gTG9nTGV2ZWwuREVCVUc7XHJcbiAgICAgIGNhc2UgJ0lORk8nOiByZXR1cm4gTG9nTGV2ZWwuSU5GTztcclxuICAgICAgY2FzZSAnV0FSTic6IHJldHVybiBMb2dMZXZlbC5XQVJOO1xyXG4gICAgICBjYXNlICdFUlJPUic6IHJldHVybiBMb2dMZXZlbC5FUlJPUjtcclxuICAgICAgZGVmYXVsdDogcmV0dXJuIExvZ0xldmVsLklORk87XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNob3VsZExvZyhsZXZlbDogTG9nTGV2ZWwpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBsZXZlbCA+PSB0aGlzLmxvZ0xldmVsO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjcmVhdGVMb2dFbnRyeShcclxuICAgIGxldmVsOiBMb2dMZXZlbCxcclxuICAgIG1lc3NhZ2U6IHN0cmluZyxcclxuICAgIGNvbnRleHQ/OiBMb2dDb250ZXh0LFxyXG4gICAgZXJyb3I/OiBFcnJvcixcclxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxyXG4gICk6IExvZ0VudHJ5IHtcclxuICAgIGNvbnN0IGVudHJ5OiBMb2dFbnRyeSA9IHtcclxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIGxldmVsOiBMb2dMZXZlbFtsZXZlbF0sXHJcbiAgICAgIG1lc3NhZ2UsXHJcbiAgICAgIGNvbnRleHQ6IHsgLi4udGhpcy5jb250ZXh0LCAuLi5jb250ZXh0IH0sXHJcbiAgICAgIG1ldGFkYXRhLFxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgZW50cnkuZXJyb3IgPSB7XHJcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcclxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZW50cnk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGxvZyhsZXZlbDogTG9nTGV2ZWwsIG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGVycm9yPzogRXJyb3IsIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLnNob3VsZExvZyhsZXZlbCkpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuY3JlYXRlTG9nRW50cnkobGV2ZWwsIG1lc3NhZ2UsIGNvbnRleHQsIGVycm9yLCBtZXRhZGF0YSk7XHJcbiAgICBcclxuICAgIC8vIFVzZSBhcHByb3ByaWF0ZSBjb25zb2xlIG1ldGhvZCBiYXNlZCBvbiBsZXZlbFxyXG4gICAgc3dpdGNoIChsZXZlbCkge1xyXG4gICAgICBjYXNlIExvZ0xldmVsLkRFQlVHOlxyXG4gICAgICAgIGNvbnNvbGUuZGVidWcoSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBMb2dMZXZlbC5JTkZPOlxyXG4gICAgICAgIGNvbnNvbGUuaW5mbyhKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIExvZ0xldmVsLldBUk46XHJcbiAgICAgICAgY29uc29sZS53YXJuKEpTT04uc3RyaW5naWZ5KGVudHJ5KSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgTG9nTGV2ZWwuRVJST1I6XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVidWcobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogdm9pZCB7XHJcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5ERUJVRywgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBtZXRhZGF0YSk7XHJcbiAgfVxyXG5cclxuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuSU5GTywgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBtZXRhZGF0YSk7XHJcbiAgfVxyXG5cclxuICB3YXJuKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xyXG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuV0FSTiwgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBtZXRhZGF0YSk7XHJcbiAgfVxyXG5cclxuICBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIGVycm9yPzogRXJyb3IsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkIHtcclxuICAgIHRoaXMubG9nKExvZ0xldmVsLkVSUk9SLCBtZXNzYWdlLCBjb250ZXh0LCBlcnJvciwgbWV0YWRhdGEpO1xyXG4gIH1cclxuXHJcbiAgLy8gQnVzaW5lc3MgbWV0cmljcyBsb2dnaW5nXHJcbiAgbG9nQnVzaW5lc3NNZXRyaWMoXHJcbiAgICBtZXRyaWNOYW1lOiBzdHJpbmcsXHJcbiAgICB2YWx1ZTogbnVtYmVyLFxyXG4gICAgdW5pdDogc3RyaW5nID0gJ0NvdW50JyxcclxuICAgIGNvbnRleHQ/OiBMb2dDb250ZXh0LFxyXG4gICAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XHJcbiAgKTogdm9pZCB7XHJcbiAgICB0aGlzLmluZm8oYPCfk4ogQnVzaW5lc3MgTWV0cmljOiAke21ldHJpY05hbWV9YCwgY29udGV4dCwge1xyXG4gICAgICBtZXRyaWM6IHtcclxuICAgICAgICBuYW1lOiBtZXRyaWNOYW1lLFxyXG4gICAgICAgIHZhbHVlLFxyXG4gICAgICAgIHVuaXQsXHJcbiAgICAgIH0sXHJcbiAgICAgIC4uLm1ldGFkYXRhLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvLyBQZXJmb3JtYW5jZSB0aW1pbmdcclxuICBsb2dQZXJmb3JtYW5jZShcclxuICAgIG9wZXJhdGlvbjogc3RyaW5nLFxyXG4gICAgZHVyYXRpb246IG51bWJlcixcclxuICAgIHN1Y2Nlc3M6IGJvb2xlYW4sXHJcbiAgICBjb250ZXh0PzogTG9nQ29udGV4dCxcclxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxyXG4gICk6IHZvaWQge1xyXG4gICAgY29uc3Qgc3RhdHVzID0gc3VjY2VzcyA/ICdTVUNDRVNTJyA6ICdGQUlMRUQnO1xyXG4gICAgdGhpcy5pbmZvKGDij7HvuI8gJHtvcGVyYXRpb259OiAke2R1cmF0aW9ufW1zICgke3N0YXR1c30pYCwgY29udGV4dCwge1xyXG4gICAgICBwZXJmb3JtYW5jZToge1xyXG4gICAgICAgIG9wZXJhdGlvbixcclxuICAgICAgICBkdXJhdGlvbixcclxuICAgICAgICBzdWNjZXNzLFxyXG4gICAgICB9LFxyXG4gICAgICAuLi5tZXRhZGF0YSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gQ3JlYXRlIGNoaWxkIGxvZ2dlciB3aXRoIGFkZGl0aW9uYWwgY29udGV4dFxyXG4gIGNoaWxkKGFkZGl0aW9uYWxDb250ZXh0OiBMb2dDb250ZXh0KTogVHJpbml0eUxvZ2dlciB7XHJcbiAgICByZXR1cm4gbmV3IFRyaW5pdHlMb2dnZXIoeyAuLi50aGlzLmNvbnRleHQsIC4uLmFkZGl0aW9uYWxDb250ZXh0IH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gVXBkYXRlIGNvbnRleHQgZm9yIGN1cnJlbnQgbG9nZ2VyXHJcbiAgdXBkYXRlQ29udGV4dChhZGRpdGlvbmFsQ29udGV4dDogTG9nQ29udGV4dCk6IHZvaWQge1xyXG4gICAgdGhpcy5jb250ZXh0ID0geyAuLi50aGlzLmNvbnRleHQsIC4uLmFkZGl0aW9uYWxDb250ZXh0IH07XHJcbiAgfVxyXG59XHJcblxyXG4vLyBQZXJmb3JtYW5jZSB0aW1lciB1dGlsaXR5XHJcbmV4cG9ydCBjbGFzcyBQZXJmb3JtYW5jZVRpbWVyIHtcclxuICBwcml2YXRlIHN0YXJ0VGltZTogbnVtYmVyO1xyXG4gIHByaXZhdGUgbG9nZ2VyOiBUcmluaXR5TG9nZ2VyO1xyXG4gIHByaXZhdGUgb3BlcmF0aW9uOiBzdHJpbmc7XHJcblxyXG4gIGNvbnN0cnVjdG9yKG9wZXJhdGlvbjogc3RyaW5nLCBsb2dnZXI6IFRyaW5pdHlMb2dnZXIpIHtcclxuICAgIHRoaXMub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xyXG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XHJcbiAgICB0aGlzLnN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICBcclxuICAgIHRoaXMubG9nZ2VyLmRlYnVnKGDwn5qAIFN0YXJ0aW5nICR7b3BlcmF0aW9ufWApO1xyXG4gIH1cclxuXHJcbiAgZmluaXNoKHN1Y2Nlc3M6IGJvb2xlYW4gPSB0cnVlLCBlcnJvclR5cGU/OiBzdHJpbmcsIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xyXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydFRpbWU7XHJcbiAgICBcclxuICAgIHRoaXMubG9nZ2VyLmxvZ1BlcmZvcm1hbmNlKHRoaXMub3BlcmF0aW9uLCBkdXJhdGlvbiwgc3VjY2VzcywgdW5kZWZpbmVkLCB7XHJcbiAgICAgIGVycm9yVHlwZSxcclxuICAgICAgLi4ubWV0YWRhdGEsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGZpbmlzaFdpdGhFcnJvcihlcnJvcjogRXJyb3IsIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55Pik6IHZvaWQge1xyXG4gICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gdGhpcy5zdGFydFRpbWU7XHJcbiAgICBcclxuICAgIHRoaXMubG9nZ2VyLmVycm9yKGDinYwgJHt0aGlzLm9wZXJhdGlvbn0gZmFpbGVkIGFmdGVyICR7ZHVyYXRpb259bXNgLCBlcnJvciwgdW5kZWZpbmVkLCBtZXRhZGF0YSk7XHJcbiAgICB0aGlzLmZpbmlzaChmYWxzZSwgZXJyb3IubmFtZSwgbWV0YWRhdGEpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gRGVmYXVsdCBsb2dnZXIgaW5zdGFuY2VcclxuZXhwb3J0IGNvbnN0IGxvZ2dlciA9IG5ldyBUcmluaXR5TG9nZ2VyKCk7XHJcblxyXG4vLyBGYWN0b3J5IGZ1bmN0aW9uIGZvciBjcmVhdGluZyBsb2dnZXJzIHdpdGggY29udGV4dFxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTG9nZ2VyKGNvbnRleHQ6IExvZ0NvbnRleHQpOiBUcmluaXR5TG9nZ2VyIHtcclxuICByZXR1cm4gbmV3IFRyaW5pdHlMb2dnZXIoY29udGV4dCk7XHJcbn1cclxuXHJcbi8vIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBjb21tb24gbG9nZ2luZyBwYXR0ZXJuc1xyXG5leHBvcnQgY29uc3QgTG9nVXRpbHMgPSB7XHJcbiAgLy8gTG9nIExhbWJkYSBmdW5jdGlvbiBzdGFydFxyXG4gIGxvZ0Z1bmN0aW9uU3RhcnQ6IChmdW5jdGlvbk5hbWU6IHN0cmluZywgZXZlbnQ6IGFueSwgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgIGxvZ2dlci5pbmZvKGDwn4+gICR7ZnVuY3Rpb25OYW1lfSBIYW5kbGVyIFN0YXJ0ZWRgLCBjb250ZXh0LCB7XHJcbiAgICAgIGV2ZW50OiBKU09OLnN0cmluZ2lmeShldmVudCwgbnVsbCwgMiksXHJcbiAgICB9KTtcclxuICB9LFxyXG5cclxuICAvLyBMb2cgTGFtYmRhIGZ1bmN0aW9uIGVuZFxyXG4gIGxvZ0Z1bmN0aW9uRW5kOiAoZnVuY3Rpb25OYW1lOiBzdHJpbmcsIHJlc3VsdDogYW55LCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgbG9nZ2VyLmluZm8oYOKchSAke2Z1bmN0aW9uTmFtZX0gSGFuZGxlciBDb21wbGV0ZWRgLCBjb250ZXh0LCB7XHJcbiAgICAgIHJlc3VsdDogdHlwZW9mIHJlc3VsdCA9PT0gJ29iamVjdCcgPyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIG51bGwsIDIpIDogcmVzdWx0LFxyXG4gICAgfSk7XHJcbiAgfSxcclxuXHJcbiAgLy8gTG9nIEdyYXBoUUwgb3BlcmF0aW9uXHJcbiAgbG9nR3JhcGhRTE9wZXJhdGlvbjogKGZpZWxkTmFtZTogc3RyaW5nLCBhcmdzOiBhbnksIHVzZXJJZD86IHN0cmluZykgPT4ge1xyXG4gICAgbG9nZ2VyLmluZm8oYPCflI0gR3JhcGhRTCBPcGVyYXRpb246ICR7ZmllbGROYW1lfWAsIHsgdXNlcklkLCBvcGVyYXRpb246IGZpZWxkTmFtZSB9LCB7XHJcbiAgICAgIGFyZ3VtZW50czogSlNPTi5zdHJpbmdpZnkoYXJncywgbnVsbCwgMiksXHJcbiAgICB9KTtcclxuICB9LFxyXG5cclxuICAvLyBMb2cgZGF0YWJhc2Ugb3BlcmF0aW9uXHJcbiAgbG9nRGF0YWJhc2VPcGVyYXRpb246IChvcGVyYXRpb246IHN0cmluZywgdGFibGVOYW1lOiBzdHJpbmcsIGtleTogYW55LCBjb250ZXh0PzogTG9nQ29udGV4dCkgPT4ge1xyXG4gICAgbG9nZ2VyLmRlYnVnKGDwn5eE77iPIER5bmFtb0RCICR7b3BlcmF0aW9ufWAsIHsgLi4uY29udGV4dCwgdGFibGVOYW1lIH0sIHtcclxuICAgICAga2V5OiBKU09OLnN0cmluZ2lmeShrZXkpLFxyXG4gICAgfSk7XHJcbiAgfSxcclxuXHJcbiAgLy8gTG9nIGV4dGVybmFsIEFQSSBjYWxsXHJcbiAgbG9nRXh0ZXJuYWxBUElDYWxsOiAoc2VydmljZTogc3RyaW5nLCBlbmRwb2ludDogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpID0+IHtcclxuICAgIGxvZ2dlci5kZWJ1Zyhg8J+MkCBFeHRlcm5hbCBBUEkgQ2FsbDogJHtzZXJ2aWNlfWAsIGNvbnRleHQsIHtcclxuICAgICAgZW5kcG9pbnQsXHJcbiAgICAgIG1ldGhvZCxcclxuICAgIH0pO1xyXG4gIH0sXHJcblxyXG4gIC8vIExvZyBjYWNoZSBvcGVyYXRpb25cclxuICBsb2dDYWNoZU9wZXJhdGlvbjogKG9wZXJhdGlvbjogc3RyaW5nLCBjYWNoZUtleTogc3RyaW5nLCBoaXQ6IGJvb2xlYW4sIGNvbnRleHQ/OiBMb2dDb250ZXh0KSA9PiB7XHJcbiAgICBjb25zdCBzdGF0dXMgPSBoaXQgPyAnSElUJyA6ICdNSVNTJztcclxuICAgIGxvZ2dlci5kZWJ1Zyhg8J+SviBDYWNoZSAke29wZXJhdGlvbn06ICR7c3RhdHVzfWAsIGNvbnRleHQsIHtcclxuICAgICAgY2FjaGVLZXksXHJcbiAgICAgIGhpdCxcclxuICAgIH0pO1xyXG4gIH0sXHJcbn07Il19