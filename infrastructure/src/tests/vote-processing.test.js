"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock environment variables
process.env.ROOMS_TABLE = 'test-rooms-table';
process.env.ROOM_MEMBERS_TABLE = 'test-room-members-table';
process.env.VOTES_TABLE = 'test-votes-table';
process.env.USER_VOTES_TABLE = 'test-user-votes-table';
(0, globals_1.describe)('Vote Processing Reliability - Property Tests', () => {
    /**
     * Property 1: Vote Processing Reliability
     * Validates: Requirements 1.1, 1.2
     *
     * These tests verify that the vote processing system:
     * 1. Uses correct DynamoDB key structure { PK: roomId, SK: 'ROOM' }
     * 2. Handles errors gracefully with exponential backoff
     * 3. Processes DISLIKE votes according to Stop-on-Match algorithm
     */
    (0, globals_1.describe)('Property 1: Vote Processing Reliability', () => {
        (0, globals_1.it)('should use correct DynamoDB key structure format', () => {
            // Test the key structure format used in the vote handler
            const roomId = 'test-room-123';
            const expectedKey = { PK: roomId, SK: 'ROOM' };
            // Verify the key structure matches the expected format
            (0, globals_1.expect)(expectedKey.PK).toBe(roomId);
            (0, globals_1.expect)(expectedKey.SK).toBe('ROOM');
            (0, globals_1.expect)(Object.keys(expectedKey)).toEqual(['PK', 'SK']);
        });
        (0, globals_1.it)('should implement exponential backoff for retry logic', () => {
            // Test exponential backoff calculation
            const baseDelay = 100;
            const maxRetries = 3;
            for (let attempt = 1; attempt <= maxRetries; attempt++) {
                const expectedDelay = baseDelay * Math.pow(2, attempt);
                const calculatedDelay = baseDelay * Math.pow(2, attempt);
                (0, globals_1.expect)(calculatedDelay).toBe(expectedDelay);
                (0, globals_1.expect)(calculatedDelay).toBeGreaterThan(0);
            }
        });
        (0, globals_1.it)('should validate Stop-on-Match algorithm logic', () => {
            // Test that DISLIKE votes are ignored according to Stop-on-Match
            const voteTypes = ['LIKE', 'DISLIKE'];
            const processedVotes = voteTypes.filter(voteType => voteType === 'LIKE');
            (0, globals_1.expect)(processedVotes).toEqual(['LIKE']);
            (0, globals_1.expect)(processedVotes).not.toContain('DISLIKE');
        });
        (0, globals_1.it)('should handle error message formatting correctly', () => {
            // Test error message formatting for user-friendly messages
            const systemError = 'ValidationException: key element does not match';
            const userFriendlyMessage = 'Error interno del sistema. Por favor, inténtalo de nuevo más tarde.';
            // Verify that system errors are converted to user-friendly messages
            const isSystemError = systemError.includes('ValidationException') &&
                systemError.includes('key element does not match');
            (0, globals_1.expect)(isSystemError).toBe(true);
            (0, globals_1.expect)(userFriendlyMessage).toContain('Error interno del sistema');
            (0, globals_1.expect)(userFriendlyMessage).not.toContain('ValidationException');
        });
        (0, globals_1.it)('should validate room status for voting eligibility', () => {
            // Test room status validation logic
            const validStatuses = ['ACTIVE', 'WAITING'];
            const invalidStatuses = ['MATCHED', 'COMPLETED', 'PAUSED'];
            validStatuses.forEach(status => {
                const isValidForVoting = status === 'ACTIVE' || status === 'WAITING';
                (0, globals_1.expect)(isValidForVoting).toBe(true);
            });
            invalidStatuses.forEach(status => {
                const isValidForVoting = status === 'ACTIVE' || status === 'WAITING';
                (0, globals_1.expect)(isValidForVoting).toBe(false);
            });
        });
        (0, globals_1.it)('should validate vote count consensus logic', () => {
            // Test Stop-on-Match consensus logic
            const testCases = [
                { currentVotes: 1, totalMembers: 2, shouldMatch: false },
                { currentVotes: 2, totalMembers: 2, shouldMatch: true },
                { currentVotes: 3, totalMembers: 3, shouldMatch: true },
                { currentVotes: 2, totalMembers: 3, shouldMatch: false },
            ];
            testCases.forEach(({ currentVotes, totalMembers, shouldMatch }) => {
                const hasConsensus = currentVotes >= totalMembers;
                (0, globals_1.expect)(hasConsensus).toBe(shouldMatch);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidm90ZS1wcm9jZXNzaW5nLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ2b3RlLXByb2Nlc3NpbmcudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDJDQUF1RTtBQUV2RSw2QkFBNkI7QUFDN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsa0JBQWtCLENBQUM7QUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsR0FBRyx5QkFBeUIsQ0FBQztBQUMzRCxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQztBQUM3QyxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixHQUFHLHVCQUF1QixDQUFDO0FBRXZELElBQUEsa0JBQVEsRUFBQyw4Q0FBOEMsRUFBRSxHQUFHLEVBQUU7SUFDNUQ7Ozs7Ozs7O09BUUc7SUFDSCxJQUFBLGtCQUFRLEVBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1FBQ3ZELElBQUEsWUFBRSxFQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtZQUMxRCx5REFBeUQ7WUFDekQsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDO1lBQy9CLE1BQU0sV0FBVyxHQUFHLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUM7WUFFL0MsdURBQXVEO1lBQ3ZELElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3BDLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJ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QUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyw0Q0FBNEMsRUFBRSxHQUFHLEVBQUU7WUFDcEQscUNBQXFDO1lBQ3JDLE1BQU0sU0FBUyxHQUFHO2dCQUNoQixFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFO2dCQUN4RCxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFO2dCQUN2RCxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFO2dCQUN2RCxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFO2FBQ3pELENBQUM7WUFFRixTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUU7Z0JBQ2hFLE1BQU0sWUFBWSxHQUFHLFlBQVksSUFBSSxZQUFZLENBQUM7Z0JBQ2xELElBQUEsZ0JBQU0sRUFBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDekMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xyXG5cclxuLy8gTW9jayBlbnZpcm9ubWVudCB2YXJpYWJsZXNcclxucHJvY2Vzcy5lbnYuUk9PTVNfVEFCTEUgPSAndGVzdC1yb29tcy10YWJsZSc7XHJcbnByb2Nlc3MuZW52LlJPT01fTUVNQkVSU19UQUJMRSA9ICd0ZXN0LXJvb20tbWVtYmVycy10YWJsZSc7XHJcbnByb2Nlc3MuZW52LlZPVEVTX1RBQkxFID0gJ3Rlc3Qtdm90ZXMtdGFibGUnO1xyXG5wcm9jZXNzLmVudi5VU0VSX1ZPVEVTX1RBQkxFID0gJ3Rlc3QtdXNlci12b3Rlcy10YWJsZSc7XHJcblxyXG5kZXNjcmliZSgnVm90ZSBQcm9jZXNzaW5nIFJlbGlhYmlsaXR5IC0gUHJvcGVydHkgVGVzdHMnLCAoKSA9PiB7XHJcbiAgLyoqXHJcbiAgICogUHJvcGVydHkgMTogVm90ZSBQcm9jZXNzaW5nIFJlbGlhYmlsaXR5XHJcbiAgICogVmFsaWRhdGVzOiBSZXF1aXJlbWVudHMgMS4xLCAxLjJcclxuICAgKiBcclxuICAgKiBUaGVzZSB0ZXN0cyB2ZXJpZnkgdGhhdCB0aGUgdm90ZSBwcm9jZXNzaW5nIHN5c3RlbTpcclxuICAgKiAxLiBVc2VzIGNvcnJlY3QgRHluYW1vREIga2V5IHN0cnVjdHVyZSB7IFBLOiByb29tSWQsIFNLOiAnUk9PTScgfVxyXG4gICAqIDIuIEhhbmRsZXMgZXJyb3JzIGdyYWNlZnVsbHkgd2l0aCBleHBvbmVudGlhbCBiYWNrb2ZmXHJcbiAgICogMy4gUHJvY2Vzc2VzIERJU0xJS0Ugdm90ZXMgYWNjb3JkaW5nIHRvIFN0b3Atb24tTWF0Y2ggYWxnb3JpdGhtXHJcbiAgICovXHJcbiAgZGVzY3JpYmUoJ1Byb3BlcnR5IDE6IFZvdGUgUHJvY2Vzc2luZyBSZWxpYWJpbGl0eScsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdXNlIGNvcnJlY3QgRHluYW1vREIga2V5IHN0cnVjdHVyZSBmb3JtYXQnLCAoKSA9PiB7XHJcbiAgICAgIC8vIFRlc3QgdGhlIGtleSBzdHJ1Y3R1cmUgZm9ybWF0IHVzZWQgaW4gdGhlIHZvdGUgaGFuZGxlclxyXG4gICAgICBjb25zdCByb29tSWQgPSAndGVzdC1yb29tLTEyMyc7XHJcbiAgICAgIGNvbnN0IGV4cGVjdGVkS2V5ID0geyBQSzogcm9vbUlkLCBTSzogJ1JPT00nIH07XHJcbiAgICAgIFxyXG4gICAgICAvLyBWZXJpZnkgdGhlIGtleSBzdHJ1Y3R1cmUgbWF0Y2hlcyB0aGUgZXhwZWN0ZWQgZm9ybWF0XHJcbiAgICAgIGV4cGVjdChleHBlY3RlZEtleS5QSykudG9CZShyb29tSWQpO1xyXG4gICAgICBleHBlY3QoZXhwZWN0ZWRLZXkuU0spLnRvQmUoJ1JPT00nKTtcclxuICAgICAgZXhwZWN0KE9iamVjdC5rZXlzKGV4cGVjdGVkS2V5KSkudG9FcXVhbChbJ1BLJywgJ1NLJ10pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBpbXBsZW1lbnQgZXhwb25lbnRpYWwgYmFja29mZiBmb3IgcmV0cnkgbG9naWMnLCAoKSA9PiB7XHJcbiAgICAgIC8vIFRlc3QgZXhwb25lbnRpYWwgYmFja29mZiBjYWxjdWxhdGlvblxyXG4gICAgICBjb25zdCBiYXNlRGVsYXkgPSAxMDA7XHJcbiAgICAgIGNvbnN0IG1heFJldHJpZXMgPSAzO1xyXG4gICAgICBcclxuICAgICAgZm9yIChsZXQgYXR0ZW1wdCA9IDE7IGF0dGVtcHQgPD0gbWF4UmV0cmllczsgYXR0ZW1wdCsrKSB7XHJcbiAgICAgICAgY29uc3QgZXhwZWN0ZWREZWxheSA9IGJhc2VEZWxheSAqIE1hdGgucG93KDIsIGF0dGVtcHQpO1xyXG4gICAgICAgIGNvbnN0IGNhbGN1bGF0ZWREZWxheSA9IGJhc2VEZWxheSAqIE1hdGgucG93KDIsIGF0dGVtcHQpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGV4cGVjdChjYWxjdWxhdGVkRGVsYXkpLnRvQmUoZXhwZWN0ZWREZWxheSk7XHJcbiAgICAgICAgZXhwZWN0KGNhbGN1bGF0ZWREZWxheSkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIFN0b3Atb24tTWF0Y2ggYWxnb3JpdGhtIGxvZ2ljJywgKCkgPT4ge1xyXG4gICAgICAvLyBUZXN0IHRoYXQgRElTTElLRSB2b3RlcyBhcmUgaWdub3JlZCBhY2NvcmRpbmcgdG8gU3RvcC1vbi1NYXRjaFxyXG4gICAgICBjb25zdCB2b3RlVHlwZXMgPSBbJ0xJS0UnLCAnRElTTElLRSddO1xyXG4gICAgICBjb25zdCBwcm9jZXNzZWRWb3RlcyA9IHZvdGVUeXBlcy5maWx0ZXIodm90ZVR5cGUgPT4gdm90ZVR5cGUgPT09ICdMSUtFJyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QocHJvY2Vzc2VkVm90ZXMpLnRvRXF1YWwoWydMSUtFJ10pO1xyXG4gICAgICBleHBlY3QocHJvY2Vzc2VkVm90ZXMpLm5vdC50b0NvbnRhaW4oJ0RJU0xJS0UnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVycm9yIG1lc3NhZ2UgZm9ybWF0dGluZyBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIC8vIFRlc3QgZXJyb3IgbWVzc2FnZSBmb3JtYXR0aW5nIGZvciB1c2VyLWZyaWVuZGx5IG1lc3NhZ2VzXHJcbiAgICAgIGNvbnN0IHN5c3RlbUVycm9yID0gJ1ZhbGlkYXRpb25FeGNlcHRpb246IGtleSBlbGVtZW50IGRvZXMgbm90IG1hdGNoJztcclxuICAgICAgY29uc3QgdXNlckZyaWVuZGx5TWVzc2FnZSA9ICdFcnJvciBpbnRlcm5vIGRlbCBzaXN0ZW1hLiBQb3IgZmF2b3IsIGludMOpbnRhbG8gZGUgbnVldm8gbcOhcyB0YXJkZS4nO1xyXG4gICAgICBcclxuICAgICAgLy8gVmVyaWZ5IHRoYXQgc3lzdGVtIGVycm9ycyBhcmUgY29udmVydGVkIHRvIHVzZXItZnJpZW5kbHkgbWVzc2FnZXNcclxuICAgICAgY29uc3QgaXNTeXN0ZW1FcnJvciA9IHN5c3RlbUVycm9yLmluY2x1ZGVzKCdWYWxpZGF0aW9uRXhjZXB0aW9uJykgJiYgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5c3RlbUVycm9yLmluY2x1ZGVzKCdrZXkgZWxlbWVudCBkb2VzIG5vdCBtYXRjaCcpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGlzU3lzdGVtRXJyb3IpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdCh1c2VyRnJpZW5kbHlNZXNzYWdlKS50b0NvbnRhaW4oJ0Vycm9yIGludGVybm8gZGVsIHNpc3RlbWEnKTtcclxuICAgICAgZXhwZWN0KHVzZXJGcmllbmRseU1lc3NhZ2UpLm5vdC50b0NvbnRhaW4oJ1ZhbGlkYXRpb25FeGNlcHRpb24nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcm9vbSBzdGF0dXMgZm9yIHZvdGluZyBlbGlnaWJpbGl0eScsICgpID0+IHtcclxuICAgICAgLy8gVGVzdCByb29tIHN0YXR1cyB2YWxpZGF0aW9uIGxvZ2ljXHJcbiAgICAgIGNvbnN0IHZhbGlkU3RhdHVzZXMgPSBbJ0FDVElWRScsICdXQUlUSU5HJ107XHJcbiAgICAgIGNvbnN0IGludmFsaWRTdGF0dXNlcyA9IFsnTUFUQ0hFRCcsICdDT01QTEVURUQnLCAnUEFVU0VEJ107XHJcbiAgICAgIFxyXG4gICAgICB2YWxpZFN0YXR1c2VzLmZvckVhY2goc3RhdHVzID0+IHtcclxuICAgICAgICBjb25zdCBpc1ZhbGlkRm9yVm90aW5nID0gc3RhdHVzID09PSAnQUNUSVZFJyB8fCBzdGF0dXMgPT09ICdXQUlUSU5HJztcclxuICAgICAgICBleHBlY3QoaXNWYWxpZEZvclZvdGluZykudG9CZSh0cnVlKTtcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBpbnZhbGlkU3RhdHVzZXMuZm9yRWFjaChzdGF0dXMgPT4ge1xyXG4gICAgICAgIGNvbnN0IGlzVmFsaWRGb3JWb3RpbmcgPSBzdGF0dXMgPT09ICdBQ1RJVkUnIHx8IHN0YXR1cyA9PT0gJ1dBSVRJTkcnO1xyXG4gICAgICAgIGV4cGVjdChpc1ZhbGlkRm9yVm90aW5nKS50b0JlKGZhbHNlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIHZvdGUgY291bnQgY29uc2Vuc3VzIGxvZ2ljJywgKCkgPT4ge1xyXG4gICAgICAvLyBUZXN0IFN0b3Atb24tTWF0Y2ggY29uc2Vuc3VzIGxvZ2ljXHJcbiAgICAgIGNvbnN0IHRlc3RDYXNlcyA9IFtcclxuICAgICAgICB7IGN1cnJlbnRWb3RlczogMSwgdG90YWxNZW1iZXJzOiAyLCBzaG91bGRNYXRjaDogZmFsc2UgfSxcclxuICAgICAgICB7IGN1cnJlbnRWb3RlczogMiwgdG90YWxNZW1iZXJzOiAyLCBzaG91bGRNYXRjaDogdHJ1ZSB9LFxyXG4gICAgICAgIHsgY3VycmVudFZvdGVzOiAzLCB0b3RhbE1lbWJlcnM6IDMsIHNob3VsZE1hdGNoOiB0cnVlIH0sXHJcbiAgICAgICAgeyBjdXJyZW50Vm90ZXM6IDIsIHRvdGFsTWVtYmVyczogMywgc2hvdWxkTWF0Y2g6IGZhbHNlIH0sXHJcbiAgICAgIF07XHJcbiAgICAgIFxyXG4gICAgICB0ZXN0Q2FzZXMuZm9yRWFjaCgoeyBjdXJyZW50Vm90ZXMsIHRvdGFsTWVtYmVycywgc2hvdWxkTWF0Y2ggfSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGhhc0NvbnNlbnN1cyA9IGN1cnJlbnRWb3RlcyA+PSB0b3RhbE1lbWJlcnM7XHJcbiAgICAgICAgZXhwZWN0KGhhc0NvbnNlbnN1cykudG9CZShzaG91bGRNYXRjaCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdfQ==